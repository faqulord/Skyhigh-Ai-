<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Owner HQ | <%= brandName %></title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@800&family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <script>
        function toggleSidebar() {
            const sb = document.getElementById('sidebar');
            const ov = document.getElementById('overlay');
            if (sb.classList.contains('open')) { sb.classList.remove('open'); ov.classList.remove('show'); }
            else { sb.classList.add('open'); ov.classList.add('show'); }
        }
        function switchTab(id) {
            document.querySelectorAll('.page-section').forEach(e => e.classList.add('hidden'));
            document.querySelectorAll('.menu-item').forEach(b => b.classList.remove('active'));
            document.getElementById('tab-'+id).classList.remove('hidden');
            document.getElementById('btn-'+id).classList.add('active');
            toggleSidebar(); window.scrollTo(0,0);
        }
    </script>
    <style>
        body { background: #000000; color: #fff; font-family: 'Inter', sans-serif; overflow-x: hidden; }
        .tech-card { background: #111; border: 1px solid #333; border-radius: 16px; margin-bottom: 20px; }
        .hidden { display: none !important; }
        #sidebar { position: fixed; top: 0; left: 0; width: 260px; height: 100vh; background: #09090b; border-right: 1px solid #333; z-index: 99999; transform: translateX(-100%); transition: 0.3s; padding-top: 80px; }
        #sidebar.open { transform: translateX(0); }
        #overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 99998; display: none; }
        #overlay.show { display: block; }
        .menu-item { display: flex; align-items: center; gap: 15px; width: 100%; padding: 18px 25px; color: #888; font-size: 11px; font-weight: bold; text-transform: uppercase; border-bottom: 1px solid #1c1c1c; }
        .menu-item.active { color: #c084fc; border-left: 4px solid #c084fc; background: #18181b; }
        .orange-neon { color: #FF9F43; text-shadow: 0 0 5px rgba(255, 159, 67, 0.5); font-weight: bold; }
    </style>
</head>
<body class="min-h-screen">
    <div id="overlay" onclick="toggleSidebar()"></div>

    <nav id="sidebar">
        <button onclick="switchTab('dashboard')" id="btn-dashboard" class="menu-item active">VEZ√âRL≈êPULT</button>
        <button onclick="switchTab('chat')" id="btn-chat" class="menu-item">STRAT√âGIA CHAT</button>
        <button onclick="switchTab('marketing')" id="btn-marketing" class="menu-item">MARKETING</button>
        <button onclick="switchTab('users')" id="btn-users" class="menu-item">TAGOK</button>
        <button onclick="switchTab('finance')" id="btn-finance" class="menu-item">P√âNZ√úGY</button>
        <div class="absolute bottom-5 left-0 w-full text-center"><a href="/logout" class="text-red-500 text-xs font-bold uppercase">Kijelentkez√©s</a></div>
    </nav>

    <header class="fixed top-0 left-0 w-full bg-black/90 border-b border-zinc-900 p-3 z-[5000] flex justify-between items-center h-[70px]">
        <button onclick="toggleSidebar()" class="text-white bg-zinc-900 p-3 rounded-xl">‚ò∞</button>
        <span class="text-2xl">ü¶ä HQ</span>
        <a href="/dashboard" class="bg-zinc-900 text-white text-[10px] px-3 py-2 rounded-lg">DASH</a>
    </header>

    <main class="pt-[90px] px-4 pb-10 w-full max-w-3xl mx-auto">
        <div id="tab-dashboard" class="page-section">
            <h2 class="text-lg font-bold mb-4 text-zinc-400">Vez√©rl≈ëpult</h2>
            <div class="tech-card p-5 border-t-2 border-t-orange-500">
                <div class="flex justify-between items-center mb-4 text-[10px] font-bold text-zinc-500 uppercase tracking-widest">
                    <span>Strat√©gia</span><span class="orange-neon">AKT√çV: <%= strategyMode.toUpperCase() %></span>
                </div>
                <form action="/admin/update-settings" method="POST" class="grid grid-cols-3 gap-2">
                    <button name="mode" value="recovery" class="py-3 rounded-xl text-[9px] font-bold border <%= strategyMode === 'recovery' ? 'bg-blue-600 border-blue-400' : 'bg-zinc-900 border-zinc-700 text-zinc-500' %>">üõ°Ô∏è √ìVATOS</button>
                    <button name="mode" value="normal" class="py-3 rounded-xl text-[9px] font-bold border <%= strategyMode === 'normal' ? 'bg-purple-600 border-purple-400' : 'bg-zinc-900 border-zinc-700 text-zinc-500' %>">ü¶ä NORMAL</button>
                    <button name="mode" value="aggressive" class="py-3 rounded-xl text-[9px] font-bold border <%= strategyMode === 'aggressive' ? 'bg-orange-600 border-orange-400' : 'bg-zinc-900 border-zinc-700 text-zinc-500' %>">üî• ZSIV√ÅNY</button>
                </form>
            </div>
            <div class="tech-card p-5">
                <% if (currentTip) { %>
                    <h3 class="text-xl font-black mb-1"><%= currentTip.match %></h3>
                    <p class="text-xs text-purple-400 font-mono mb-4 font-bold"><%= currentTip.prediction %></p>
                    <form action="/admin/refine-text" method="POST" class="mb-4"><button class="w-full bg-zinc-800 text-[10px] py-3 rounded-xl border border-zinc-700 font-bold uppercase">üìù SZ√ñVEG JAV√çT√ÅSA</button></form>
                    <div class="grid grid-cols-2 gap-3 mt-4">
                        <form action="/admin/settle-tip" method="POST"><input type="hidden" name="status" value="win"><button class="w-full bg-green-900/30 border border-green-500 text-green-500 py-3 rounded-xl text-xs font-bold uppercase">WIN ‚úÖ</button></form>
                        <form action="/admin/settle-tip" method="POST"><input type="hidden" name="status" value="loss"><button class="w-full bg-red-900/30 border border-red-500 text-red-500 py-3 rounded-xl text-xs font-bold uppercase">LOSS ‚ùå</button></form>
                    </div>
                <% } else { %>
                    <form action="/admin/run-robot" method="POST" class="text-center py-10"><button class="bg-white text-black px-8 py-4 rounded-xl font-black uppercase text-xs">üöÄ Elemz√©s Ind√≠t√°sa</button></form>
                <% } %>
            </div>
        </div>

        <div id="tab-users" class="page-section hidden">
            <h2 class="text-lg font-bold mb-4 text-zinc-400">Tagok</h2>
            <div class="space-y-2">
                <% users.forEach(u => { 
                    let p = strategyMode === 'aggressive' ? 0.06 : (strategyMode === 'recovery' ? 0.015 : 0.03);
                    let bank = u.currentBankroll || u.startingCapital || 0;
                    let mProfit = u.monthlyProfit || 0;
                %> 
                    <div class="tech-card p-4 flex justify-between items-center">
                        <div>
                            <p class="text-xs font-bold text-white"><%= u.fullname %></p>
                            <p class="text-[9px] text-zinc-500">Bank: <%= bank.toLocaleString() %> Ft</p>
                            <p class="text-[9px] <%= mProfit >= 0 ? 'text-green-500' : 'text-red-500' %>">Havi: <%= mProfit > 0 ? '+' : '' %><%= mProfit.toLocaleString() %> Ft</p>
                        </div>
                        <div class="text-right"><p class="text-[9px] text-zinc-500 uppercase">T√©t:</p><p class="text-sm font-black orange-neon"><%= Math.round(bank * p).toLocaleString() %> Ft</p></div>
                    </div> 
                <% }) %>
            </div>
        </div>

        <div id="tab-marketing" class="page-section hidden">
            <h2 class="text-lg font-bold mb-4 text-zinc-400">Marketing</h2>
            <div class="tech-card p-5 mb-4">
                <h3 class="text-xs font-bold mb-2">Insta Gener√°tor</h3>
                <div class="flex gap-2 mb-2"><button onclick="generateSocial('win')" class="flex-1 bg-zinc-800 text-green-400 border border-green-900/30 py-2 rounded text-[10px] font-bold uppercase">üèÜ Nyer≈ë</button><button onclick="generateSocial('motivation')" class="flex-1 bg-zinc-800 text-pink-400 border border-pink-900/30 py-2 rounded text-[10px] font-bold uppercase">üî• Motiv√°ci√≥</button></div>
                <textarea id="social-result" rows="4" class="w-full bg-black border border-zinc-800 rounded p-2 text-xs text-white"></textarea>
            </div>
            <div class="tech-card p-5">
                <h3 class="text-xs font-bold mb-2">H√≠rlev√©l</h3>
                <input type="text" id="email-topic" class="w-full bg-black border border-zinc-800 rounded p-2 text-xs text-white mb-2" placeholder="T√©ma...">
                <button onclick="draftEmail()" class="w-full bg-blue-600 text-white py-2 rounded text-[10px] font-bold uppercase">√çr√°s</button>
            </div>
        </div>

        <div id="tab-chat" class="page-section hidden">
            <h2 class="text-lg font-bold mb-4 text-zinc-400">Strat√©gia Chat</h2>
            <div class="tech-card p-4">
                <div id="chat-win" class="chat-container overflow-y-auto mb-4 custom-scrollbar" style="height:350px"><% chatHistory.forEach(msg => { %> <div class="msg <%= msg.sender === 'F≈ën√∂k' ? 'msg-me' : 'msg-ai' %>"><strong><%= msg.sender %>:</strong> <%= msg.text %></div> <% }) %></div>
                <div class="flex gap-2"><input type="text" id="chat-in" class="flex-1 bg-black border border-zinc-800 rounded px-4 py-3 text-xs text-white" placeholder="√çrj..."><button onclick="talk()" class="bg-purple-600 text-white px-4 py-3 rounded font-bold">‚û§</button></div>
            </div>
        </div>

        <div id="tab-finance" class="page-section hidden">
            <h2 class="text-lg font-bold mb-4 text-zinc-400">P√©nz√ºgy</h2>
            <div class="tech-card p-5 border border-red-900/30">
                <h3 class="text-xs font-bold mb-2 text-red-500 uppercase">H√≥nap Z√°r√°sa</h3>
                <p class="text-[10px] text-zinc-500 mb-4">Ez lenull√°zza minden tag "Havi Profit" mutat√≥j√°t. Csak h√≥nap elsej√©n haszn√°ld!</p>
                <form action="/admin/reset-monthly" method="POST" onsubmit="return confirm('Biztos ind√≠tod az √∫j h√≥napot?')">
                    <button class="w-full bg-red-900/20 text-red-500 border border-red-900/50 py-3 rounded-xl font-bold text-xs uppercase">üîÑ √öJ H√ìNAP IND√çT√ÅSA</button>
                </form>
            </div>
        </div>
    </main>
    <script>
        const win = document.getElementById('chat-win'); if(win) win.scrollTop = win.scrollHeight;
        async function talk() { const i = document.getElementById('chat-in'); if(!i.value) return; const msgText = i.value; i.value = ''; win.innerHTML += `<div class="msg msg-me"><strong>F≈ën√∂k:</strong> ${msgText}</div>`; win.scrollTop = win.scrollHeight; try { const r = await fetch('/admin/chat', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({message: msgText})}); const d = await r.json(); win.innerHTML += `<div class="msg msg-ai"><strong>R√≥ka:</strong> ${d.reply}</div>`; win.scrollTop = win.scrollHeight; } catch (err) { console.error(err); } }
        async function generateSocial(type) { const btn = event.target; const originalText = btn.innerText; btn.innerText = "..."; try { const res = await fetch('/admin/social-content', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ type }) }); const data = await res.json(); document.getElementById('social-result').value = data.content; } catch(e) { alert('Hiba!'); } btn.innerText = originalText; }
        async function draftEmail() { const topic = document.getElementById('email-topic').value; if(!topic) return alert("√çrj t√©m√°t!"); try { const res = await fetch('/admin/draft-email', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ topic }) }); const data = await res.json(); alert("V√°zlat k√©sz! (Console logban)"); console.log(data.draft); } catch(e) { alert("AI Hiba"); } }
    </script>
</body>
</html>