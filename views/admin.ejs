<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Owner HQ | <%= brandName %></title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@800&family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <script>
        function toggleSidebar() {
            const sb = document.getElementById('sidebar');
            const ov = document.getElementById('overlay');
            sb.classList.toggle('open');
            ov.classList.toggle('show');
        }
        function switchTab(id) {
            document.querySelectorAll('.page-section').forEach(e => e.classList.add('hidden'));
            document.querySelectorAll('.menu-item').forEach(b => b.classList.remove('active'));
            document.getElementById('tab-'+id).classList.remove('hidden');
            document.getElementById('btn-'+id).classList.add('active');
            if(window.innerWidth < 1024) toggleSidebar();
            window.scrollTo(0,0);
        }
        function startAnalysis(btn) {
            btn.innerHTML = '<span class="inline-block animate-spin mr-2">ü¶ä</span> Elemz√©s...';
            btn.classList.add('opacity-50', 'cursor-not-allowed');
        }
    </script>
    <style>
        body { background: #000; color: #fff; font-family: 'Inter', sans-serif; }
        .tech-card { background: #0a0a0a; border: 1px solid #222; border-radius: 20px; margin-bottom: 20px; }
        .hidden { display: none !important; }
        #sidebar { position: fixed; top: 0; left: 0; width: 260px; height: 100vh; background: #09090b; border-right: 1px solid #222; z-index: 50; padding-top: 80px; transform: translateX(-100%); transition: 0.3s; }
        #sidebar.open { transform: translateX(0); }
        #overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 40; display: none; backdrop-filter: blur(3px); }
        #overlay.show { display: block; }
        .menu-item { display: flex; align-items: center; gap: 15px; width: 100%; padding: 18px 25px; color: #666; font-size: 11px; font-weight: 800; text-transform: uppercase; cursor: pointer; border-left: 3px solid transparent; }
        .menu-item.active { color: #fff; background: #111; border-left-color: #c084fc; }
        .msg { padding: 10px; border-radius: 10px; font-size: 12px; margin-bottom: 5px; }
        .msg-me { background: #2563eb; align-self: flex-end; }
        .msg-ai { background: #222; border: 1px solid #333; }
    </style>
</head>
<body class="min-h-screen">
    <div id="overlay" onclick="toggleSidebar()"></div>

    <nav id="sidebar">
        <div onclick="switchTab('dashboard')" id="btn-dashboard" class="menu-item active">üìä VEZ√âRL≈êPULT</div>
        <div onclick="switchTab('users')" id="btn-users" class="menu-item">üë• TAGOK</div>
        <div onclick="switchTab('marketing')" id="btn-marketing" class="menu-item">üì¢ MARKETING</div>
        <div onclick="switchTab('chat')" id="btn-chat" class="menu-item">ü§ñ R√ìKA AGYA</div>
        <div onclick="switchTab('finance')" id="btn-finance" class="menu-item">üí∞ P√âNZ√úGY</div>
        <div class="absolute bottom-5 left-0 w-full px-6"><a href="/logout" class="block text-center text-red-500 py-3 border border-red-900/30 rounded-xl text-[10px] font-black uppercase">Kil√©p√©s</a></div>
    </nav>

    <header class="fixed top-0 left-0 w-full bg-black/90 border-b border-zinc-900 p-4 z-40 flex justify-between items-center h-[70px]">
        <button onclick="toggleSidebar()" class="text-white bg-zinc-900 p-2 rounded-lg border border-zinc-700">‚ò∞</button>
        <span class="font-black orbitron text-purple-500 tracking-widest uppercase"><%= brandName %> HQ</span>
        <a href="/dashboard" class="text-[10px] font-bold border border-zinc-600 px-3 py-1 rounded-lg">DASH</a>
    </header>

    <main class="pt-[90px] px-4 pb-10 max-w-2xl mx-auto">

        <div id="tab-dashboard" class="page-section">
            <h2 class="text-sm font-black mb-4 border-l-4 border-purple-500 pl-3 uppercase">Aktu√°lis √©s F√ºgg≈ë meccsek</h2>
            
            <div class="tech-card p-6 border-t-2 border-t-orange-500 mb-6">
                <form action="/admin/update-settings" method="POST" class="grid grid-cols-3 gap-3">
                    <button name="mode" value="recovery" class="py-3 rounded-xl text-[9px] font-black border transition <%= strategyMode === 'recovery' ? 'bg-blue-600 border-blue-400 text-white' : 'bg-zinc-900 border-zinc-800 text-zinc-500' %>">√ìVATOS</button>
                    <button name="mode" value="normal" class="py-3 rounded-xl text-[9px] font-black border transition <%= strategyMode === 'normal' ? 'bg-purple-600 border-purple-400 text-white' : 'bg-zinc-900 border-zinc-800 text-zinc-500' %>">NORM√ÅL</button>
                    <button name="mode" value="aggressive" class="py-3 rounded-xl text-[9px] font-black border transition <%= strategyMode === 'aggressive' ? 'bg-orange-600 border-orange-400 text-white' : 'bg-zinc-900 border-zinc-800 text-zinc-500' %>">ZSIV√ÅNY</button>
                </form>
            </div>

            <% if (pendingTips && pendingTips.length > 0) { %>
                <% pendingTips.forEach(tip => { %>
                    <div class="tech-card p-6 bg-zinc-900/10">
                        <div class="flex justify-between items-center mb-2"><span class="text-[10px] text-zinc-500 font-bold uppercase"><%= tip.date %></span></div>
                        <h3 class="text-lg font-black"><%= tip.match %></h3>
                        <p class="text-purple-400 font-bold mb-4"><%= tip.prediction %> (@<%= tip.odds %>)</p>
                        
                        <div class="grid grid-cols-2 gap-3 mb-4">
                            <form action="/admin/settle-tip" method="POST"><input type="hidden" name="tipId" value="<%= tip._id %>"><input type="hidden" name="status" value="win"><button class="w-full bg-green-900/40 border border-green-500 text-green-500 py-4 rounded-xl font-black text-[10px] uppercase">WIN ‚úÖ</button></form>
                            <form action="/admin/settle-tip" method="POST"><input type="hidden" name="tipId" value="<%= tip._id %>"><input type="hidden" name="status" value="loss"><button class="w-full bg-red-900/40 border border-red-500 text-red-500 py-4 rounded-xl font-black text-[10px] uppercase">LOSS ‚ùå</button></form>
                        </div>

                        <% if(!tip.isPublished) { %>
                            <form action="/admin/publish-tip" method="POST"><input type="hidden" name="tipId" value="<%= tip._id %>"><button class="w-full bg-blue-600 text-white py-3 rounded-xl font-black text-[10px] uppercase">üöÄ PUBLIK√ÅL√ÅS TAGOKNAK</button></form>
                        <% } %>
                    </div>
                <% }) %>
            <% } else { %>
                <form action="/admin/run-robot" method="POST" onsubmit="startAnalysis(this.querySelector('button'))" class="text-center py-10">
                    <button class="bg-white text-black px-10 py-5 rounded-2xl font-black uppercase text-xs">üöÄ Elemz√©s Ind√≠t√°sa</button>
                </form>
            <% } %>
        </div>

        <div id="tab-users" class="page-section hidden">
            <h2 class="text-sm font-black mb-4 border-l-4 border-green-500 pl-3 uppercase">Tagok kezel√©se</h2>
            <div class="space-y-2">
                <% users.forEach(u => { 
                    let isExpired = u.licenseExpiresAt && new Date() > new Date(u.licenseExpiresAt);
                %> 
                    <div class="tech-card p-4 flex justify-between items-center">
                        <div>
                            <p class="text-xs font-bold"><%= u.fullname %> <span class="text-[10px] text-zinc-500"><%= u.email %></span></p>
                            <p class="text-[9px] <%= isExpired ? 'text-red-500' : 'text-green-500' %> uppercase font-black">
                                <%= u.licenseExpiresAt ? new Date(u.licenseExpiresAt).toLocaleDateString() : 'Nincs licenc' %>
                            </p>
                        </div>
                        <div class="flex gap-2">
                            <form action="/admin/manage-sub" method="POST"><input type="hidden" name="userId" value="<%= u._id %>"><input type="hidden" name="action" value="add30"><button class="bg-green-600 text-white text-[9px] px-3 py-2 rounded-lg font-bold uppercase">+30 Nap</button></form>
                            <form action="/admin/manage-sub" method="POST"><input type="hidden" name="userId" value="<%= u._id %>"><input type="hidden" name="action" value="revoke"><button class="bg-red-600 text-white text-[9px] px-3 py-2 rounded-lg font-bold uppercase">Tilt</button></form>
                        </div>
                    </div> 
                <% }) %>
            </div>
        </div>

        <div id="tab-marketing" class="page-section hidden">
            <h2 class="text-sm font-black mb-4 border-l-4 border-pink-500 pl-3 uppercase">Marketing AI</h2>
            <div class="tech-card p-6">
                <div class="flex gap-2 mb-4"><button onclick="generateSocial('win')" class="flex-1 bg-zinc-800 text-green-400 py-3 rounded-xl text-[10px] font-black uppercase">üèÜ NYER≈ê POSZT</button><button onclick="generateSocial('motivation')" class="flex-1 bg-zinc-800 text-pink-400 py-3 rounded-xl text-[10px] font-black uppercase">üî• MOTIV√ÅCI√ì</button></div>
                <textarea id="social-result" rows="5" class="w-full bg-black border border-zinc-800 rounded-xl p-4 text-xs text-white focus:border-pink-500 outline-none" placeholder="AI sz√∂veg..."></textarea>
            </div>
        </div>

        <div id="tab-chat" class="page-section hidden">
            <h2 class="text-sm font-black mb-4 border-l-4 border-fuchsia-500 pl-3 uppercase">R√≥ka Agya</h2>
            <div class="tech-card p-4">
                <div id="chat-win" class="overflow-y-auto mb-4 custom-scrollbar" style="height:300px"><% chatHistory.forEach(msg => { %> <div class="msg <%= msg.sender === 'F≈ën√∂k' ? 'msg-me' : 'msg-ai' %>"><strong><%= msg.sender %>:</strong> <%= msg.text %></div> <% }) %></div>
                <div class="flex gap-2"><input type="text" id="chat-in" class="flex-1 bg-black border border-zinc-800 rounded-xl px-4 py-3 text-xs text-white outline-none focus:border-purple-500" placeholder="Utas√≠t√°s..."><button onclick="talk()" class="bg-purple-600 text-white px-5 py-3 rounded-xl font-bold">‚û§</button></div>
            </div>
        </div>

    </main>
    <script>
        const win = document.getElementById('chat-win'); if(win) win.scrollTop = win.scrollHeight;
        async function talk() { const i = document.getElementById('chat-in'); if(!i.value) return; const msgText = i.value; i.value = ''; win.innerHTML += `<div class="msg msg-me"><strong>F≈ën√∂k:</strong> ${msgText}</div>`; win.scrollTop = win.scrollHeight; try { const r = await fetch('/admin/chat', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({message: msgText})}); const d = await r.json(); win.innerHTML += `<div class="msg msg-ai"><strong>R√≥ka:</strong> ${d.reply}</div>`; win.scrollTop = win.scrollHeight; } catch (err) { console.error(err); } }
        async function generateSocial(type) { const res = await fetch('/admin/social-content', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ type }) }); const data = await res.json(); document.getElementById('social-result').value = data.content; }
    </script>
</body>
</html>