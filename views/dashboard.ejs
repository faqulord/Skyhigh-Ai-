<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skyhigh AI | Vez√©rl≈ëpult</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;800&display=swap');
        
        body { 
            background-color: #000000; 
            color: #e4e4e7; /* zinc-200 */
            font-family: 'Inter', sans-serif; 
        }
        
        /* Modern K√°rty√°k (Fintech st√≠lus) */
        .card { 
            background: #09090b; /* zinc-950 */
            border: 1px solid #27272a; /* zinc-800 */
            border-radius: 20px; 
            padding: 24px;
            transition: all 0.3s ease;
        }
        .card:hover { border-color: #3f3f46; /* zinc-700 */ }
        
        /* Pr√©mium akt√≠v k√°rtya */
        .card-active { 
            background: linear-gradient(145deg, #09090b 0%, #051a0d 100%);
            border: 1px solid #15803d; /* green-700 */
        }

        /* Hom√°lyos√≠tott √úveg (Frosted Glass) - A titok */
        .locked-content {
            position: relative;
            overflow: hidden;
        }
        .locked-overlay {
            position: absolute;
            inset: 0;
            background: rgba(9, 9, 11, 0.6);
            backdrop-filter: blur(12px);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        /* Modern Gombok */
        .btn-primary { 
            background: white; 
            color: black; 
            font-weight: 600; 
            font-size: 13px;
            padding: 12px 20px; 
            border-radius: 12px; 
            width: 100%; 
            display: block; 
            text-align: center;
            transition: 0.2s;
        }
        .btn-primary:hover { background: #d4d4d8; transform: translateY(-1px); }

        .btn-admin { 
            background: #f59e0b; color: black; font-weight: 700; 
            font-size: 11px; text-transform: uppercase; letter-spacing: 1px;
            padding: 8px 16px; border-radius: 8px; margin-bottom: 24px; display: inline-block;
        }

        /* Chat Bubor√©kok (iMessage st√≠lus) */
        .chat-container { background: #09090b; border: 1px solid #27272a; border-radius: 20px; height: 500px; display: flex; flex-direction: column; }
        .bubble-ai { 
            background: #27272a; color: white; 
            padding: 10px 16px; border-radius: 18px 18px 18px 4px; 
            font-size: 13px; margin-bottom: 12px; max-width: 85%; line-height: 1.5;
        }
        .bubble-label { font-size: 10px; color: #a1a1aa; margin-bottom: 4px; display: block; font-weight: 600; }
        
        /* St√°tusz Lista */
        .status-item { display: flex; items-center; justify-content: space-between; font-size: 12px; padding: 8px 0; border-bottom: 1px solid #27272a; color: #a1a1aa; }
        .status-item:last-child { border-bottom: none; }
        .check-icon { color: #22c55e; margin-left: 8px; }

    </style>
</head>
<body class="p-6 md:p-10 max-w-7xl mx-auto pb-32">

    <% 
        const today = new Date();
        const dateStr = today.toLocaleDateString('hu-HU', { month: 'long', day: 'numeric' });
        
        const yesterday = new Date();
        yesterday.setDate(yesterday.getDate() - 1);
        const yestStr = yesterday.toLocaleDateString('hu-HU', { month: '2-digit', day: '2-digit' });
    %>

    <header class="flex flex-col md:flex-row justify-between items-start md:items-center mb-12 gap-4">
        <div>
            <h1 class="text-2xl font-bold text-white tracking-tight">Szia, <%= user.fullname.split(' ')[0] %> üëã</h1>
            <p class="text-sm text-zinc-500 font-medium">Itt a mai piaci √°ttekint√©sed.</p>
        </div>
        
        <div class="flex items-center gap-6">
            <div class="flex items-center gap-2 px-4 py-2 bg-zinc-900 rounded-full border border-zinc-800">
                <span class="w-2 h-2 rounded-full <%= user.hasLicense ? 'bg-green-500' : 'bg-orange-500' %>"></span>
                <span class="text-xs font-semibold <%= user.hasLicense ? 'text-green-500' : 'text-zinc-400' %>">
                    <%= user.hasLicense ? 'Pr√©mium El≈ëfizet≈ë' : 'Ingyenes Fi√≥k' %>
                </span>
            </div>
            <a href="/logout" class="text-sm font-medium text-zinc-500 hover:text-white transition">Kil√©p√©s</a>
        </div>
    </header>

    <% if (isAdmin) { %> 
        <a href="/admin" class="btn-admin"><i class="fas fa-crown mr-2"></i> Igazgat√≥i M√≥d</a> 
    <% } %>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

        <div class="space-y-6">
            
            <% if (user.hasLicense) { %>
                <div class="card card-active">
                    <div class="flex justify-between items-center mb-4">
                        <span class="text-xs font-semibold text-green-400 uppercase tracking-wider">Mai Teljes√≠tm√©ny</span>
                        <i class="fas fa-chart-pie text-green-500"></i>
                    </div>
                    <div class="flex items-baseline gap-2">
                        <h2 class="text-4xl font-bold text-white">+4.8%</h2>
                        <span class="text-sm text-green-500 font-medium">Profit</span>
                    </div>
                    <p class="text-xs text-zinc-500 mt-2">A t≈ëk√©d a tervezett √ºtemben n√∂vekszik.</p>
                </div>

                <div class="card">
                    <div class="flex justify-between items-center mb-6">
                        <span class="text-xs font-bold text-white bg-zinc-800 px-3 py-1 rounded-full"><%= dateStr %></span>
                        <span class="text-xs text-purple-400 font-bold">PREMIER LEAGUE</span>
                    </div>
                    
                    <div class="flex justify-between items-center mb-4">
                        <div class="text-center w-full">
                            <p class="text-lg font-bold text-white">MAN. CITY</p>
                            <p class="text-[10px] text-zinc-500">vs</p>
                            <p class="text-lg font-bold text-white">LIVERPOOL</p>
                        </div>
                    </div>
                    
                    <div class="bg-zinc-900 border border-zinc-800 rounded-xl p-4 flex justify-between items-center">
                        <span class="text-xs text-zinc-400">A Robot v√°laszt√°sa:</span>
                        <span class="text-sm font-bold text-white">HAZAI (1.85)</span>
                    </div>
                </div>

                <div class="bg-zinc-900 rounded-xl p-4 border border-zinc-800">
                    <div class="flex justify-between text-xs mb-2">
                        <span class="text-zinc-400">Havi Ciklus</span>
                        <span class="text-white font-bold">1 / 30 Nap</span>
                    </div>
                    <div class="w-full bg-zinc-800 h-2 rounded-full overflow-hidden">
                        <div class="bg-white h-full w-[3%]"></div>
                    </div>
                </div>

            <% } else { %>
                
                <div class="card">
                    <h3 class="text-sm font-semibold text-white mb-4">Rendszer Elemz√©s (<%= dateStr %>)</h3>
                    <div class="space-y-1">
                        <div class="status-item">
                            <span>Glob√°lis piacok sz≈±r√©se</span>
                            <i class="fas fa-check-circle check-icon"></i>
                        </div>
                        <div class="status-item">
                            <span>S√©r√ºl√©sek ellen≈ërz√©se</span>
                            <i class="fas fa-check-circle check-icon"></i>
                        </div>
                        <div class="status-item">
                            <span>Kock√°zat elemz√©s</span>
                            <i class="fas fa-check-circle check-icon"></i>
                        </div>
                        <div class="status-item">
                            <span class="text-white font-bold">Nyeres√©ges lehet≈ës√©g tal√°lva</span>
                            <span class="text-green-500 font-bold">IGEN</span>
                        </div>
                    </div>
                </div>

                <div class="card locked-content p-0">
                    <div class="p-6 filter blur-[4px]">
                        <div class="flex justify-between items-center mb-6">
                            <span class="text-xs font-bold text-zinc-600 bg-zinc-900 px-3 py-1 rounded-full"><%= dateStr %></span>
                            <span class="text-xs text-zinc-600 font-bold">PREMIER LEAGUE</span>
                        </div>
                        <div class="text-center w-full mb-4">
                            <p class="text-lg font-bold text-zinc-600">MAN. CITY</p>
                            <p class="text-[10px] text-zinc-700">vs</p>
                            <p class="text-lg font-bold text-zinc-600">LIVERPOOL</p>
                        </div>
                        <div class="bg-zinc-900 rounded-xl p-4 flex justify-between">
                            <span class="text-xs text-zinc-700">Tipp:</span>
                            <span class="text-sm font-bold text-zinc-700">HAZAI</span>
                        </div>
                    </div>

                    <div class="locked-overlay p-6 text-center">
                        <div class="w-10 h-10 rounded-full bg-zinc-800 flex items-center justify-center mb-3 border border-zinc-700">
                            <i class="fas fa-lock text-white text-sm"></i>
                        </div>
                        <h3 class="text-white font-bold text-sm mb-1">Pr√©mium Lehet≈ës√©g</h3>
                        <p class="text-xs text-zinc-400 mb-6 max-w-[200px]">
                            A Skyhigh AI 94%-os val√≥sz√≠n≈±s√©get m√©rt erre az esem√©nyre.
                        </p>
                        <a href="/fizetes" class="btn-primary">
                            Tipp Felold√°sa
                        </a>
                        <p class="text-[10px] text-orange-400 mt-3 font-medium">
                            <i class="fas fa-clock mr-1"></i> Magas √©rt√©k≈± tipp
                        </p>
                    </div>
                </div>

                <div class="flex items-center gap-4 p-4 bg-zinc-900/50 rounded-xl border border-zinc-800/50">
                    <div class="w-8 h-8 rounded-full bg-green-900/30 flex items-center justify-center text-green-500 border border-green-900/50">
                        <i class="fas fa-history text-xs"></i>
                    </div>
                    <div>
                        <p class="text-xs text-zinc-400">Tegnapi eredm√©ny (<%= yestStr %>)</p>
                        <p class="text-sm font-bold text-white">Sikeres Tipp ‚úÖ</p>
                    </div>
                </div>

            <% } %>

        </div>

        <div class="lg:col-span-2">
            <div class="chat-container">
                <div class="p-4 border-b border-zinc-800 flex justify-between items-center">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-full bg-white flex items-center justify-center">
                            <i class="fas fa-robot text-black text-sm"></i>
                        </div>
                        <div>
                            <h3 class="text-sm font-bold text-white">Skyhigh Assistant</h3>
                            <p class="text-[10px] text-zinc-500">Mindig akt√≠v</p>
                        </div>
                    </div>
                    <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                </div>

                <div id="chatBox" class="flex-1 overflow-y-auto p-6"></div>

                <div class="p-4 border-t border-zinc-800">
                    <input type="text" placeholder="√çrj az asszisztensnek..." class="w-full bg-zinc-900 border border-zinc-800 rounded-xl px-4 py-3 text-sm text-white focus:outline-none focus:border-white transition placeholder-zinc-600">
                </div>
            </div>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const chatBox = document.getElementById('chatBox');
            const hasLicense = <%= user.hasLicense %>;
            const userName = "<%= user.fullname %>"; // Csak a keresztn√©v kellene, de √≠gy is j√≥
            
            let messages = [];