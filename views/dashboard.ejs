<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skyhigh AI | Terminal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background-color: #050505; color: white; font-family: sans-serif; }
        .tech-card { background: #0f0f11; border: 1px solid #27272a; border-radius: 16px; overflow: hidden; }
        
        .ai-message { 
            background: #18181b; border-left: 2px solid #a855f7; 
            padding: 12px; margin-bottom: 12px; border-radius: 0 12px 12px 0;
            font-size: 13px; line-height: 1.5; color: #e4e4e7;
        }
        .user-message {
            background: #27272a; border-right: 2px solid #fff;
            padding: 12px; margin-bottom: 12px; border-radius: 12px 0 0 12px;
            font-size: 13px; text-align: right; color: white; margin-left: auto; max-width: 80%;
        }
    </style>
</head>
<body class="p-4 md:p-6 max-w-7xl mx-auto pb-24">

    <header class="flex justify-between items-center mb-6 border-b border-zinc-800 pb-4">
        <div>
            <h1 class="text-xl font-black uppercase italic">Skyhigh<span class="text-purple-500">.AI</span></h1>
            <p class="text-[10px] text-zinc-500">OPERATOR: <%= user.fullname.toUpperCase() %></p>
        </div>
        <div>
            <% if (user.hasLicense) { %>
                <div class="text-right">
                    <span class="text-green-500 text-xs font-bold uppercase animate-pulse">● Licenc Aktív</span>
                    <p class="text-[10px] text-zinc-500">Tőke: <%= user.startingCapital ? user.startingCapital + ' Ft' : 'Nincs beállítva' %></p>
                </div>
            <% } else { %>
                <span class="text-red-500 text-xs font-bold uppercase">● Inaktív (Demo)</span>
            <% } %>
            <a href="/logout" class="block text-right text-[10px] text-zinc-600 hover:text-white uppercase mt-1">Kijelentkezés</a>
        </div>
    </header>

    <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
        
        <div class="lg:col-span-8 tech-card flex flex-col h-[600px] relative">
            <div class="p-4 border-b border-zinc-800 bg-zinc-900/50 flex justify-between items-center">
                <span class="text-xs font-bold text-zinc-300 uppercase"><i class="fas fa-robot mr-2 text-purple-500"></i> Skyhigh Neural Net</span>
                <span class="text-[10px] text-zinc-600">v3.0 Live Connection</span>
            </div>
            
            <div id="chatBox" class="flex-1 overflow-y-auto p-4 bg-[#0a0a0a]">
                </div>

            <div class="p-3 border-t border-zinc-800 bg-zinc-900/30">
                <form id="chatForm" class="flex gap-2">
                    <input type="text" id="userInput" placeholder="Írj az AI-nak..." class="w-full bg-black border border-zinc-800 rounded p-3 text-xs text-white focus:border-purple-500 outline-none">
                    <button type="submit" class="bg-purple-600 px-4 rounded text-white font-bold"><i class="fas fa-paper-plane"></i></button>
                </form>
            </div>
        </div>

        <div class="lg:col-span-4 space-y-4">
            <% if (user.hasLicense) { %>
                
                <div class="tech-card p-6 border border-green-500/30 bg-green-900/5">
                    <h3 class="text-[10px] text-zinc-400 uppercase font-bold">Havi Terv (30 Nap)</h3>
                    <p class="text-3xl font-black text-white animate-pulse">+30%</p>
                    <p class="text-[10px] text-green-400 mt-1">Matematikai valószínűség: 98%</p>
                </div>

                <div class="tech-card p-6">
                    <h3 class="text-[10px] text-zinc-400 uppercase font-bold mb-4">Napi Fix (Max 2 Meccs)</h3>
                    
                    <% if (dailyTip) { %>
                        <div class="bg-zinc-800/50 p-3 rounded mb-3 border border-zinc-700">
                            <span class="text-[10px] text-zinc-400 block mb-1"><%= dailyTip.date %></span>
                            <div class="text-sm font-mono text-white space-y-2">
                                <p><%= dailyTip.prediction %></p>
                            </div>
                        </div>
                        <div class="inline-block bg-green-500 text-black px-4 py-1 rounded font-bold text-xs uppercase">
                            Odds: <%= dailyTip.odds %>
                        </div>
                        <p class="text-[10px] text-zinc-400 mt-3 italic"><%= dailyTip.reasoning %></p>
                    <% } else { %>
                        <div class="text-zinc-500 text-xs">Várakozás az AI elemzésre...</div>
                    <% } %>
                </div>

            <% } else { %>
                
                <div class="tech-card p-6 text-center">
                    <i class="fas fa-lock text-red-500 text-4xl mb-4"></i>
                    <h3 class="text-white font-bold mb-2">LIZENC HIÁNYZIK</h3>
                    <p class="text-xs text-zinc-400 mb-6">A Skyhigh AI matematikai tippjei csak a belső körnek érhetőek el. A havi hozam garantált, de előbb fizetned kell.</p>
                    <a href="/fizetes" class="block w-full bg-purple-600 py-3 rounded text-white font-bold uppercase text-xs">Licenc Vásárlása (20k)</a>
                </div>

            <% } %>
        </div>
    </div>

    <script>
        const chatBox = document.getElementById('chatBox');
        const chatForm = document.getElementById('chatForm');
        const userInput = document.getElementById('userInput');
        const hasLicense = <%= user.hasLicense %>;
        const userName = "<%= user.fullname.split(' ')[0] %>";

        // KEZDŐ ÜZENET (Automatikus)
        setTimeout(() => {
            if(hasLicense) {
                <% if(user.startingCapital === 0) { %>
                    addAiMessage(`Üdvözöllek a fedélzeten, ${userName}! A licence aktív. Az első és legfontosabb lépés: <strong>Mekkora tőkével indítjuk a 30 napos ciklust?</strong> Írd be az összeget (pl. 50000).`);
                <% } else { %>
                    addAiMessage(`Üdv, ${userName}. A tőkéd rögzítve (<%= user.startingCapital %> Ft). A mai 2 meccses szelvény jobb oldalt található. Tartsd a fegyelmet.`);
                <% } %>
            } else {
                addAiMessage(`Üdvözöllek. A Skyhigh AI vagyok. Látom, még nincs licenced. A rendszerem havi fix profitot termel matematikai alapon, de ehhez be kell lépned. A havi díj 20.000 Ft. Kérdezz bátran, de tippet nem adok ingyen.`);
            }
        }, 500);

        // ÜZENET KÜLDÉSE
        chatForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const text = userInput.value;
            if(!text) return;

            addUserMessage(text);
            userInput.value = '';

            // KÜLDÉS A SZERVERNEK (API)
            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: text })
                });
                const data = await response.json();
                addAiMessage(data.reply);
            } catch (err) {
                addAiMessage("Hiba a kapcsolódásban. Próbáld újra.");
            }
        });

        function addAiMessage(text) {
            const div = document.createElement('div');
            div.className = 'ai-message';
            div.innerHTML = `<strong class="text-purple-500 block text-[10px] uppercase mb-1">Skyhigh AI</strong>${text}`;
            chatBox.appendChild(div);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        function addUserMessage(text) {
            const div = document.createElement('div');
            div.className = 'user-message';
            div.textContent = text;
            chatBox.appendChild(div);
            chatBox.scrollTop = chatBox.scrollHeight;
        }
    </script>
</body>
</html>